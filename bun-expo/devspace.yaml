version: v2beta1
name: bun-expo
deployments:
  backend:
    kubectl:
      inlineManifest: |-
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: bun-expo
        spec:
          selector:
            matchLabels:
              app.kubernetes.io/name: busybox
          replicas: 1
          template:
            metadata:
              labels:
                app.kubernetes.io/name: busybox
            spec:
              containers:
              - name: busybox
                image: docker.io/busybox:1.28
                env:
                  - name: OTEL_EXPORTER_OTLP_PROTOCOL
                    value: "grpc"
                  - name: OTEL_EXPORTER_OTLP_ENDPOINT
                    value: "http://otel-collector:4317"
                args:
                - sleep
                - "1000000"
                ports:
                  - name: main
                    containerPort: 8025
                    protocol: TCP
dev:
  backend:
    imageSelector: docker.io/busybox:1.28
    devImage: docker.io/oven/bun:latest
    workingDir: /app
    ssh: {}
    sync:
      - path: .:/app
        excludePaths:
          - node_modules
        startContainer: true
        onUpload:
          exec:
            - command: bun install --frozen-lockfile
              onChange: 
                - "./bun.lock"
    command:
      - bash
      - -c
      - |
        apt update && apt install -y curl && sleep 100000
    ports:
      - port: "8025"